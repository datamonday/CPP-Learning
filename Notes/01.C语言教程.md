# 课程大纲

- 初步认识
- 数据类型
- 运算符和表达式
- 流程控制
- 函数
- 数组
- 指针
- 变量的作用域和存储方式
- 扩展数据类型
- 其它：
  - 字符串的处理
  - 进制转换
  - 补码
  - 动态分配内存
  - 链表的使用

---

# 1. 初步认识

## 1.1 C 简介

C 语言是一种通用的高级语言，最初是由**丹尼斯·里奇**在贝尔实验室为开发 UNIX 操作系统而设计的。C 语言最开始是于 1972 年在 DEC PDP-11 计算机上被首次实现。

在 1978 年，布莱恩·柯林汉（Brian Kernighan）和丹尼斯·里奇（Dennis Ritchie）制作了 C 的第一个公开可用的描述，现在被称为 K&R 标准。

UNIX 操作系统，C编译器，和几乎所有的 UNIX 应用程序都是用 C 语言编写的。由于各种原因，C 语言现在已经成为一种广泛使用的专业语言。

- C 语言是为了编写 UNIX 操作系统而被发明的。
- C 语言是以 B 语言为基础的，B 语言大概是在 1970 年被引进的。
- 目前，C 语言是最广泛使用的系统程序设计语言。
- 当今最流行的 Linux 操作系统和 RDBMS（Relational Database Management System：关系数据库管理系统） MySQL 都是使用 C 语言编写的。

C 语言最初是用于系统开发工作，特别是组成操作系统的程序。由于 C 语言所产生的代码运行速度与汇编语言编写的代码运行速度几乎一样，所以采用 C 语言作为系统开发语言。

C语言程序写在一个或多个扩展名为 **".c"** 的文本文件中，例如，*hello.c*。可以使用 **"vi"**、**"vim"** 或任何其他文本编辑器来编写C 语言程序。

**C11**（也被称为C1X）指ISO标准ISO/IEC 9899:2011，是当前最新的C语言标准。在它之前的C语言标准为C99。

---
**C 编译器**

写在源文件中的源代码是人类可读的源。它需要"编译"，转为机器语言，这样 CPU 可以按给定指令执行程序。

C 语言编译器用于把源代码编译成最终的可执行程序。最常用的免费可用的编译器是 GNU 的 C/C++ 编译器， GNU 的 gcc 编译器适合于 C 和 C++ 编程语言。(*GNU*是一个自由的操作系统，其内容软件完全以GPL(通用公共许可证)方式发布。)

检查系统上是否安装了 GCC：

```shell
$ gcc -v
```

---

## 1.2 C 程序结构

C 程序主要包括以下部分：

- 预处理器指令
- 函数
- 变量
- 语句 & 表达式
- 注释

```c
#include <stdio.h>
 
int main()
{
    printf("Hello, World! \n");
 
    return 0;
}
```

- int main() 是主函数，所有的 C 语言程序都需要包含 **main()** 函数。 代码从 **main()** 函数开始执行。
- **printf()** 用于格式化输出到屏幕。**printf()** 函数在 **"stdio.h"** 头文件中声明。
- **stdio.h** 是一个头文件 (标准输入输出头文件) , **#include** 是一个预处理命令，告诉 C 编译器在实际编译之前要包含 stdio.h 文件。 当编译器遇到 **printf()** 函数时，如果没有找到 **stdio.h** 头文件，会发生编译错误。
- **return 0;** 语句用于表示退出程序。终止 main() 函数，并返回值 0。

把源代码保存在一个文件中，编译并运行它：

1. 打开一个文本编辑器，添加上述代码。

2. 保存文件为 `hello.c`。

3. 打开命令提示符，进入到保存文件所在的目录。

4. 键入 `gcc hello.c`，输入回车，编译代码。

5. 如果代码中没有错误，命令提示符会跳到下一行，并生成 `a.out` 可执行文件。

6. 现在，键入 `a.out` 来执行程序。

7. 可以看到屏幕上显示 `"Hello World"`。

   ```shell
   $ gcc hello.c
   $ ./a.out
   Hello, World!
   ```

   如果是多个 c 代码的源码文件，编译方法如下：

   ```shell
   $ gcc test1.c test2.c -o main.out
   $ ./main.out
   ```

   test1.c 与 test2.c 是两个源代码文件。

---

## 1.3 C 基本语法

C 程序由各种令牌组成，令牌可以是**关键字、标识符、常量、字符串值**，或者是**一个符号**。例如，下面的 C 语句包括五个令牌：

```c
printf("Hello, World! \n");
```

这五个令牌分别是：

```c
printf
(
"Hello, World! \n"
)
;
```

**分号**：在 C 程序中，分号是语句结束符。也就是说，每个语句必须以分号结束。它表明一个逻辑实体的结束。

**C 语言的注释：**

```
// 单行注释
```

以 **//** 开始的单行注释，这种注释可以单独占一行。

```
/* 单行注释 */
/* 
 多行注释
 多行注释
 多行注释
 */
```

**标识符**

C 标识符是用来标识变量、函数，或任何其他用户自定义项目的名称。

一个标识符以字母 A-Z 或 a-z 或下划线 _ 开始，后跟零个或多个字母、下划线和数字（0-9）。

C 标识符内不允许出现标点字符，比如 @、$ 和 %。C 是**区分大小写**的编程语言。有效的标识符：

```c
mohd       zara    abc   move_name  a_123
myname50   _temp   j     a23b9      retVal
```

**关键字**

下表列出了 C 中的保留字。这些保留字不能作为常量名、变量名或其他标识符名称。

| 关键字      | 说明                                                         |
| :---------- | :----------------------------------------------------------- |
| auto        | 声明自动变量                                                 |
| break       | 跳出当前循环                                                 |
| case        | 开关语句分支                                                 |
| **char**    | 声明字符型变量或函数返回值类型                               |
| **const**   | 定义常量，如果一个变量被 const 修饰，那么它的值就不能再被改变 |
| continue    | 结束当前循环，开始下一轮循环                                 |
| default     | 开关语句中的"其它"分支                                       |
| do          | 循环语句的循环体                                             |
| **double**  | 声明双精度浮点型变量或函数返回值类型                         |
| else        | 条件语句否定分支（与 if 连用）                               |
| enum        | 声明枚举类型                                                 |
| extern      | 声明变量或函数是在其它文件或本文件的其他位置定义             |
| **float**   | 声明浮点型变量或函数返回值类型                               |
| for         | 一种循环语句                                                 |
| goto        | 无条件跳转语句                                               |
| if          | 条件语句                                                     |
| int         | 声明整型变量或函数                                           |
| **long**    | 声明长整型变量或函数返回值类型                               |
| register    | 声明寄存器变量                                               |
| return      | 子程序返回语句（可以带参数，也可不带参数）                   |
| short       | 声明短整型变量或函数                                         |
| signed      | 声明有符号类型变量或函数                                     |
| **sizeof**  | 计算数据类型或变量长度（即所占字节数）                       |
| static      | 声明静态变量                                                 |
| struct      | 声明结构体类型                                               |
| switch      | 用于开关语句                                                 |
| **typedef** | 用以给数据类型取别名                                         |
| unsigned    | 声明无符号类型变量或函数                                     |
| union       | 声明共用体类型                                               |
| **void**    | 声明函数无返回值或无参数，声明无类型指针                     |
| volatile    | 说明变量在程序执行中可被隐含地改变                           |
| while       | 循环语句的循环条件                                           |

**C中的空格**

只包含空格的行，被称为空白行，可能带有注释，C 编译器会完全忽略它。

在 C 中，空格用于描述空白符、制表符、换行符和注释。

为了增强可读性，可以根据需要适当增加一些空格。

---

## 1.4 格式控制符

- `%d`：输出一个 整型。d 是 decimal 的简写；
- `%c`：输出一个字符。c 是 character 的简写。
- `%s`：输出一个字符串。s 是 string 的简写。
- `%f`：输出一个小数。f 是 float 的简写。
- `%lf` ：以十进制形式输出 double 类型。

---

- `%hd`：输出 short int 类型，hd 是 short decimal 的简写；
- `%ld`：输出 long int 类型，ld 是 long decimal 的简写。

---

- `%f` 以十进制形式输出 float 类型；
- `%lf` 以十进制形式输出 double 类型；
- `%e` 以指数形式输出 float 类型，输出结果中的 e 小写；
- `%E` 以指数形式输出 float 类型，输出结果中的 E 大写；
- `%le` 以指数形式输出 double 类型，输出结果中的 e 小写；
- `%lE` 以指数形式输出 double 类型，输出结果中的 E 大写。

---

严格来说，格式控制符和整数的符号是紧密相关的，具体就是：

- `%d` 以十进制形式输出**有符号数**；
- `%u` 以十进制形式输出无符号数；
- `%o` 以八进制形式输出无符号数；
- `%x` 以十六进制形式输出无符号数。

下表全面地总结了不同类型的整数，以不同进制的形式输出时对应的格式控制符（`--`表示没有对应的格式控制符）。

|          | short | int  | long | unsigned short | unsigned int | unsigned long |
| -------- | ----- | ---- | ---- | -------------- | ------------ | ------------- |
| 八进制   | --    | --   | --   | %ho            | %o           | %lo           |
| 十进制   | %hd   | %d   | %ld  | %hu            | %u           | %lu           |
| 十六进制 | --    | --   | --   | %hx 或者 %hX   | %x 或者 %X   | %lx 或者 %lX  |

- 当以有符号数的形式输出时，printf 会读取数字所占用的内存，并把最高位作为符号位，把剩下的内存作为数值位；
- 当以无符号数的形式输出时，printf 也会读取数字所占用的内存，并把所有的内存都作为数值位对待。

如果对一个有符号的负数使用 `%o` 或者 `%x` 输出，结果会大相径庭。

```c
#include <stdio.h>
int main()
{
    short a = 0100;  //八进制
    int b = -0x1;  //十六进制
    long c = 720;  //十进制
   
    unsigned short m = 0xffff;  //十六进制
    unsigned int n = 0x80000000;  //十六进制
    unsigned long p = 100;  //十进制
   
    //以无符号的形式输出有符号数
    printf("a=%#ho, b=%#x, c=%ld\n", a, b, c);
    //以有符号数的形式输出无符号类型（只能以十进制形式输出）
    printf("m=%hd, n=%d, p=%ld\n", m, n, p);

    return 0;
}
```

运行结果：

```c
a=0100, b=0xffffffff, c=720
m=-1, n=-2147483648, p=100
```

---

# 2. C 数据类型

<font color=red>**字节（Byte，B）是存储数据的单位，并且是硬件所能访问的最小单位。**</font>

- 1B = 8 bit；
- 1K = 1024B；（1024 = 2^10）
- 1M = 1024K；

**硬盘容量的计算方式以1000为单位，计算机内部以1024为单位，所以硬盘容量实际显示的容量小于标称容量**。

**网速指的是bit per seconds，100M宽带（100M bit/s）的下载速度大概维持在12MB/s（100M / 8）**。

---

在C语言中，数据类型指的是用于声明不同类型的变量或函数的一个广泛的系统。变量的类型决定了变量存储占用的空间，以及如何解释存储的位模式。

C语言中的类型可以分为：

| 序号 | 类型与描述                                                   |
| :--- | :----------------------------------------------------------- |
| 1    | **基本类型**：它们是算术类型，包括两种类型：【整数类型】和【浮点类型】。 |
| 2    | 【**枚举类型**】：它们也是算术类型，被用来定义在程序中只能赋予其一定的离散整数值的变量。 |
| 3    | 【**void 类型**】： 类型说明符 *void* 表明没有可用的值。     |
| 4    | **派生类型**：它们包括：【指针类型】、【数组类型】、【结构类型】、【共用体类型】和【函数类型】。 |

数组类型和结构类型统称为聚合类型。函数的类型指的是函数返回值的类型。

---

## 2.1 整数类型（int、char、short、long）

| 类型           | 存储大小    | 值范围                                               |
| :------------- | :---------- | :--------------------------------------------------- |
| **char**       | 1 字节      | -128 到 127 或 0 到 255                              |
| unsigned char  | 1 字节      | 0 到 255                                             |
| signed char    | 1 字节      | -128 到 127                                          |
| **int**        | 2 或 4 字节 | -32,768 到 32,767 或 -2,147,483,648 到 2,147,483,647 |
| unsigned int   | 2 或 4 字节 | 0 到 65,535 或 0 到 4,294,967,295                    |
| **short**      | 2 字节      | -32,768 到 32,767                                    |
| unsigned short | 2 字节      | 0 到 65,535                                          |
| **long**       | 4 字节      | -2,147,483,648 到 2,147,483,647                      |
| unsigned long  | 4 字节      | 0 到 4,294,967,295                                   |

可以使用 `sizeof(type)` 运算符查看对象或类型的存储字节大小。

```c
#include <stdio.h>
#include <limits.h>
 
int main()
{  // %lu 为 32 位无符号整数
   printf("int 存储大小 : %lu \n", sizeof(int));
   
   return 0;
}
```

---

## 2.2 浮点类型（float、double）

| 类型        | 存储大小 | 值范围                 | 精度      |
| :---------- | :------- | :--------------------- | :-------- |
| float       | 4 字节   | 1.2E-38 到 3.4E+38     | 6 位小数  |
| double      | 8 字节   | 2.3E-308 到 1.7E+308   | 15 位小数 |
| long double | 16 字节  | 3.4E-4932 到 1.1E+4932 | 19 位小数 |

头文件 float.h 定义了宏，在程序中可以使用这些值和其他有关实数二进制表示的细节。

```c
#include <stdio.h>
#include <float.h>
 
int main()
{
   printf("float 存储最大字节数 : %lu \n", sizeof(float));
   printf("float 最小值: %E\n", FLT_MIN );
   printf("float 最大值: %E\n", FLT_MAX );
   printf("精度值: %d\n", FLT_DIG );
   
   return 0;
}
```

**%E** 为以指数形式输出单、双精度实数。

## 2.3 void 类型

void 类型指定没有可用的值。它通常用于以下三种情况下：

| 序号 | 类型与描述                                                   |
| :--- | :----------------------------------------------------------- |
| 1    | **函数返回为空** <br>C 中有各种函数都不返回值，或者您可以说它们返回空。不返回值的函数的返回类型为空。例如 **void exit (int status);** |
| 2    | **函数参数为空**<br/> C 中有各种函数不接受任何参数。不带参数的函数可以接受一个 void。例如 **int rand(void);** |
| 3    | **指针指向 void**<br/> 类型为 `void *` 的指针代表对象的地址，而不是类型。例如，内存分配函数 `void *malloc( size_t size )`; 返回指向 void 的指针，可以转换为任何数据类型。 |

---

# 3. C 变量

<font color=red>**变量是程序可操作的存储区的名称（内存中的一段存储空间）**</font>。C 语言中每个变量都有特定的类型，类型决定了变量存储的大小和布局，该范围内的值都可以存储在内存中，运算符可应用于变量上。

| 类型   | 描述                                                         |
| :----- | :----------------------------------------------------------- |
| char   | 通常是一个字节（八位）, 这是一个整数类型。                   |
| int    | 整型，4 个字节，取值范围 -2147483648 到 2147483647。         |
| float  | 单精度浮点值。单精度是这样的格式，1位符号，8位指数，23位小数。![img](https://www.runoob.com/wp-content/uploads/2014/09/v2-749cc641eb4d5dafd085e8c23f8826aa_hd.png) |
| double | 双精度浮点值。双精度是1位符号，11位指数，52位小数。![img](https://www.runoob.com/wp-content/uploads/2014/09/v2-48240f0e1e0dd33ec89100cbe2d30707_hd.png) |
| void   | 表示类型的缺失。                                             |

## 3.1 变量初始化

**一个变量一定要先初始化才可以使用，因为 c 语言中默认一个没有初始化的变量值是一个不可知的很大值**。

如果变量未初始化，则会使用存放在内存中的垃圾值（上次使用，残留在内存中的值，不确定的值），某些IDE会用填充字代替垃圾值！

初始化相当于给对应的内存空间赋值，变量指向该内存空间，也就被初始化了。 

**程序运行完之后，操作系统回收内存空间，但并不会清空内存空间中遗留下来的数据**。

---

## 3.2 变量的定义

1. 变量定义：

   ```c
   type variable_list;
   ```

   **`type`** 必须是一个有效的 C 数据类型，可以是 char、w_char、int、float、double 或任何用户自定义的对象，**`variable_list`** 可以由一个或多个标识符名称组成，多个标识符之间用逗号分隔。

2. 一次可以定义多个变量，使用逗号分隔：

   ```c
   int    i, j, k;
   char   c, ch;
   float  f, salary;
   double d;
   ```

3. 变量可以在声明时被初始化：

   ```c
   type variable_name = value;
   ```

   ```c
   extern int d = 3, f = 5;    // d 和 f 的声明与初始化
   int d = 3, f = 5;           // 定义并初始化 d 和 f
   byte z = 22;                // 定义并初始化 z
   char x = 'x';               // 变量 x 的值为 'x'
   ```

---

## 3.3 变量的声明

<font color=red>**变量声明向编译器保证变量以指定的类型和名称存在，这样编译器在不需要知道变量完整细节的情况下也能继续进一步的编译。**</font>变量声明只在编译时有意义，在程序连接时编译器需要实际的变量声明。变量声明的两种情况：

1. 需要建立存储空间。例如：`int a` 在声明时已经建立了存储空间。

2. 不需要建立存储空间。使用 `extern` 关键字声明变量名而不定义它。 例如：`extern int a`， 其中变量 a 可以在别的文件中定义。

3. <font color=blue>**除非有extern关键字，否则都是变量的定义**。</font>

   ```c
   extern int i; //声明，不是定义
   int i; //声明，也是定义
   ```

实例1：

变量在头部就已经被声明，但是定义与初始化在主函数内：

```c
# include "stdio.h"

// 函数外定义变量 x 和 y
int x, y;

int add_num(){
	// 函数内声明变量 x 和 y 为外部变量
	extern int x;
	extern int y;
	
	// 给外部变量（全局变量）x 和 y 赋值
	x = 1;
	y = 2;
	
	return x + y; 
} 

int main() {
	int result;
	
	result = add_num();
	
	printf("result = %d", result);
	
	return 0;
}
```

<font color=blue>**如需在一个源文件中引用另外一个源文件中定义的变量，只需在引用的文件中将变量加上 `extern` 关键字声明即可**。</font>

---

## 3.4 左值和右值

1. 左值（Lvalues）：指向内存位置的表达式称为左值表达式。左值可以出现在赋值号的左边或右边。
2. 右值（Rvalues）：存储在内存中某些地址的数值。<font color=red> **右值是不能对其进行赋值的表达式，即右值可以在赋值号的右边，但不能在赋值号的左边**。</font>

变量是左值，因此可以出现在赋值号的左边。数值型的字面值是右值，不能被赋值，不能出现在赋值号的左边，如：

```c
int g = 20;

// 无效，导致编译错误
10 = 20
```

---

## 3.5 变量的内存寻址

**内存寻址由大到小，优先分配内存地址比较大的字节给变量，所以说变量越先定义，内存地址就越大**。 如下面代码，先定义变量 a，再定义变量 b。a 的地址比 b 的地址大 4 字节。

```c
# include "stdio.h"

int main() {
	int a;
	int b;
	// 000000000062FE1C 
	printf("int类型变量 a 的内存地址为：%p \n", &a); 
    // 000000000062FE18
	printf("int类型变量 b 的内存地址为：%p \n", &b);  
} 
```

---

## 3.6 不同变量的相互赋值问题

补码相关。溢出。

```c
# include "stdio.h"

int main() {
	int i = 408;
	long j = 9090145145;
	i = j;
	
	// 输出：500210553, 500210553 
	printf("%ld, %d \n", i, j);
	
	float x = 3.14;
	double y = 6.28;
	
	// 输出：3.140000, 6.280000 
	printf("%f, %lf \n", x, y);
}
```

---

# 4. C 常量（字面量）

常量是固定值，在程序执行期间不会改变，又称为字面量。常量可以使任何的基本数据类型。

- 整数是以补码的形式转化为二进制码存储在计算机中；
- 实数是以IEEE754为标准转化为二进制码存储在计算机中；
- 字符的本质实际上与整数的存储方式相同。

## 4.1 整数常量

整数常量可以是十进制、八进制和十进制的常量。前缀指定基数：`0x` 或 `0X` 表示**十六进制**，`0` 表示**八进制**，不带前缀则默认表示**十进制**。

整数常量也可以带一个后缀，后缀是 U 和 L 的组合，`U` 表示无符号整数（unsigned），`L` 表示长整数（long）。后缀可以是大写，也可以是小写，U 和 L 的顺序任意。

```c
85         /* 十进制 */
0213       /* 八进制 */
0x4b       /* 十六进制 */
30         /* 整数 */
30u        /* 无符号整数 */
30l        /* 长整数 */
30ul       /* 无符号长整数 */
```

---

## 4.2 浮点常量

浮点常量由整数部分、小数点、小数部分和指数部分组成。可以使用**小数形式**或者**指数形式**来表示浮点常量。

- 当使用**小数**形式表示时，必须包含整数部分、小数部分，或同时包含两者。
- 当使用**指数**形式表示时， 必须包含小数点、指数，或同时包含两者。
- 带符号的指数是用 `e` 或 `E` 引入的。

```c
3.14159       /* 合法的 */
314159E-5L    /* 合法的 */
510E          /* 非法的：不完整的指数 */
210f          /* 非法的：没有小数或指数 */
.e55          /* 非法的：缺少整数或分数 */
```

---

## 4.3 转义字符

字符集（Character Set）为每个字符分配了**唯一的编号**，称为**编码值**。在C语言中，一个字符除了可以用它的实体（也就是真正的字符）表示，还可以用编码值表示。这种使**用编码值来间接地表示字符的方式**称为**转义字符（Escape Character）**。

转义字符以 `\` 或者 `\x` 开头，以 `\` 开头表示后跟**八进制**形式的编码值，以 `\x` 开头表示后跟**十六进制**形式的编码值。**对于转义字符来说，只能使用八进制或者十六进制**。

**转义字符既可以用于单个字符，也可以用于字符串，并且一个字符串中可以同时使用八进制形式和十六进制形式**。

---

## 4.4 字符常量（''）

<font color=red>**单引号中的内容是一个 char 类型，是一个字符，这个字符对应的是 ASCII 表中的序列值**。</font> 例如：`char x = 'a';printf("%d", x)` 输出 `97(a 的 ASCII 码)` 。**ASCII码不是一个值，而是一种规定。规定了不同的字符使用哪个整数值表示**。

字符常量是括在**单引号**中，例如：`char x = 'a'`。下标列出了常用的转义序列码：

| 转义序列   | 含义                       |
| :--------- | :------------------------- |
| \\\        | \ 字符                     |
| \\'        | ' 字符                     |
| \\"        | " 字符                     |
| \?         | ? 字符                     |
| \a         | 警报铃声                   |
| \b         | 退格键                     |
| **\f**     | 换页符                     |
| \n         | 换行符                     |
| **\r**     | 回车                       |
| **\t**     | 水平制表符                 |
| \v         | 垂直制表符                 |
| \ooo       | 一到三位的八进制数         |
| \xhh . . . | 一个或多个数字的十六进制数 |

---

## 4.5 字符串常量（""）

字符串常量括在**双引号**中。<font color=red>在C语言中没有专门的字符串类型，只能使用**数组**或者**指针**间接地存储字符串。</font>

```c
char str1[] = "hello world";

char *str2 = "hi C";
```

所有的字符串（双引号""）末尾以 `\0` 为结束符。所以语句 `char ch = "a";` 是错误的，因为 `char` 类型只能存放单个字符。

---

## 4.6 定义常量(#define 和 const)

C语言的两种定义常量的方式：

1. `#define` 预处理器；

   ```c
   #define identifier value
   ```

   ```c
   #include <stdio.h>
    
   #define LENGTH 10   
   #define WIDTH  5
   #define NEWLINE '\n'
    
   int main()
   {
    
      int area;  
     
      area = LENGTH * WIDTH;
      printf("value of area : %d", area);
      printf("%c", NEWLINE);
    
      return 0;
   }
   ```

2. `const` 关键字；

   ```c
   const type variable = value;
   ```

   ```c
   #include <stdio.h>
    
   int main()
   {
      const int  LENGTH = 10;
      const int  WIDTH  = 5;
      const char NEWLINE = '\n';
      int area;  
      
      area = LENGTH * WIDTH;
      printf("value of area : %d", area);
      printf("%c", NEWLINE);
    
      return 0;
   ```

   

![img](https://www.runoob.com/wp-content/uploads/2014/09/c-const-2021-01-15.png)

![img](https://www.runoob.com/wp-content/uploads/2014/09/c-const-2021-01-15-2.png)



### 1）define与const区别

**宏**：计算机科学里的【宏】是一种抽象（Abstraction），它根据一系列预定义的规则替换一定的文本模式。解释器或编译器在遇到*宏*时会自动进行这一模式替换。

**`#define`** 是宏定义，不能定义常量，但宏定义可以实现在字面意义上和其它定义常量相同的功能。其定义的是不带类型的常数，只进行简单的字符替换。在预编译时起作用，不存在类型检查。

**`const`** 并非常量，而是带类型的变量，只是改变了变量的存储类，**把变量所占的内存变为只读**！在编译运行时起作用，不存在类型检查。

本质的区别在于**`#define`** 不为宏名分配内存，而 **`const`** 也不为常量分配内存。

二者区别：

**(1) 编译器处理方式不同**

- **`#define`** 宏是在预处理阶段展开。
-  **`const`** 常量是编译运行阶段使用。

**(2) 类型和安全检查不同**

-  **`#define`** 宏没有类型，不做任何类型检查，仅仅是展开。
-  **`const`** 常量有具体的类型，在编译阶段会执行类型检查。

**(3) 存储方式不同**

- **`#define`** 宏仅仅是展开，有多少地方使用就展开多少次，不分配内存（**宏定义不分配内存，变量定义分配内存**）。
- **`const`** 常量会在内存中分配（可以是堆中也可以是栈中）。

**(4) `const`可以节省空间，避免不必要的内存分配。**

- 从汇编的角度来看， **`const`** 定义常量只是给出了对应的内存地址，而 **`#define`** 给出的是立即数，所以  **`const`**  定义的常量在程序运行过程中只有一份拷贝（因为是全局的只读变量，存在静态区），而 **`#define`** 定义的常量在内存中有若干个拷贝。

**(5) 提高了效率。**

- 编译器通常不为普通  **`const`**  常量分配存储空间，而是将它们保存在符号表中，这使得它成为一个编译期间的常量，没有了存储与读内存的操作，使得它的效率也很高。

**(6) 宏替换只作替换，不做计算，不做表达式求解。**

- 宏预编译时就替换了，程序运行时，并不分配内存。

---

### 2）define的边缘效应

`#define` 注意“边缘效应”，例：**`#define N 2+3`**，N 的值是 5。

```c
double a;
a = (float)N/(float)2;
```

在编译时我们预想 **a=2.5**，实际打印结果是 **3.5**。原因是在预处理阶段，编译器将 **a=N/2** 处理成 **a=2+3/2**，这就是 **define** 宏的边缘效应，所以应该写成 **`#define N (2+3)`**。

```c
#include <stdio.h>

#define N 2+3
//正确写法 #define N (2+3)

int main(){   
    double a ;
    a = (float)N/(float)2;
    printf("a 的值为 : %.2f", a);   
  
    return 0;
}
```

---

# 5. C 存储类

存储类定义 C 语言程序中变量/函数的范围（可见性）和生命周期。这些说明符放置在它们所修饰的类型之前。C 程序中可用的存储类：

- `auto`：局部变量的默认存储类，限定变量只能在函数内部使用；
- `static`：全局变量的默认存储类，表示变量在程序生命周期内可见；
- `extern`：全局变量，即对程序内所有文件可见，类似于Java中的public关键字；
- `register`：代表了寄存器变量，不在内存中使用。

---

## 5.1 auto（局部，仅在函数内）

**auto** 存储类是所有局部变量默认的存储类。

```c
{
   int mount;
   auto int month;
}
```

上面的实例定义了两个带有相同存储类的变量，auto 只能用在函数内，即 auto 只能修饰局部变量。

---

## 5.2 static（全局，程序生命周期）

**在 C 语言中，`static` 可以用来修饰局部变量，全局变量以及函数。在不同的情况下 `static` 的作用不尽相同**。

**`static`** 存储类指示编译器在程序的生命周期内保持局部变量的存在，而不需要在每次它进入和离开作用域时进行创建和销毁。因此，**使用 static 修饰局部变量可以在函数调用之间保持局部变量的值**。

static 修饰符也可以应用于全局变量。**当 static 修饰全局变量时，会使变量的作用域限制在声明它的文件内**。

**全局声明的一个 static 变量或方法可以被任何函数或方法调用，只要这些方法出现在跟 static 变量或方法同一个文件中**。

---

## 5.3 extern（全局，所有文件中）

**extern** 存储类用于提供一个全局变量的引用，全局变量对所有的程序文件都是可见的。对于无法初始化的变量，**extern** 会把变量名指向一个之前定义过的存储位置。

当有多个文件且定义了一个可以在其他文件中使用的全局变量或函数时，可以在其他文件中使用 **extern** 来得到已定义的变量或函数的引用。可以这么理解，**extern** 是用来在另一个文件中声明一个全局变量或函数。

**extern** 通常用于当有两个或多个文件共享相同的全局变量或函数时。

---

## 5.4 register（寄存器变量）

**register** 存储类用于定义存储在寄存器中而不是 RAM 中的局部变量。这意味着变量的最大尺寸等于寄存器的大小（通常是一个词），且不能对它应用一元的 `&` 运算符（因为它没有内存位置）。

```c
{
   register int  miles;
}
```

**寄存器只用于需要快速访问的变量，比如计数器**。还应注意的是，定义 register 并不意味着变量将被存储在寄存器中，它意味着变量可能存储在寄存器中，这取决于硬件和实现的限制。

---

## 5.5 全局变量、局部变量、静态全局变量、静态局部变量的区别

**从作用域看：**

1、【**全局变量**】具有全局作用域。全局变量只需在一个源文件中定义，就可以作用于所有的源文件。当然，其他不包含全局变量定义的源文件需要用 `extern` 关键字再次声明这个全局变量。

2、【**静态局部变量**】具有局部作用域，它只被初始化一次，自从第一次被初始化直到程序运行结束都一直存在，它和全局变量的区别在于**全局变量对所有的函数都是可见的**，而**静态局部变量只对定义自己的函数体始终可见**。

3、【**局部变量**】也只有局部作用域，它是自动对象 `auto`，它在程序运行期间不是一直存在，而是**只在函数执行期间存在**，**函数的一次调用执行结束后，变量被撤销，其所占用的内存也被收回**。

4、【**静态全局变量**】也具有全局作用域，它与全局变量的区别在于如果程序包含多个文件的话，它作用于定义它的文件里，不能作用到其它文件里，即被 `static` 关键字修饰过的变量具有**文件作用域**。这样**即使两个不同的源文件都定义了相同名字的静态全局变量，它们也是不同的变量**。

**从分配内存空间看：**

1、全局变量，静态局部变量，静态全局变量都在静态存储区分配空间，而局**部变量在栈里分配空间**。

2、全局变量， 静态全局变量是静态存储方式。这两者的区别在于：非静态全局变量的作用域是整个源程序，当一个源程序由多个源文件组成时，非静态的全局变量在各个源文件中都是有效的。而**静态全局变量则限制了其作用域，即只在定义该变量的源文件内有效，在同一源程序的其它源文件中不能使用它**。由于静态全局变量的作用域局限于一个源文件内，只能为该源文件内的函数公用，因此**可以避免在其它源文件中引起错误**。

-  静态变量会被放在程序的静态数据存储区(全局可见)中，这样可以在下一次调用的时候还可以保持原来的赋值。这一点是它与堆栈变量和堆变量的区别。
-  变量用 `static` 告知编译器，仅在变量的作用范围内可见。这一点是它与全局变量的区别。

从以上分析可以看出， **把局部变量改变为静态变量后是改变了它的存储方式即改变了它的生存期。把全局变量改变为静态变量后是改变了它的作用域，限制了它的使用范围**。因此 `static`  在不同的地方起的作用是不同的。

**Tips:**

-  A.若全局变量仅在单个C文件中访问，则可以将这个变量修改为静态全局变量，以降低模块间的耦合度；
-  B.若全局变量仅由单个函数访问，则可以将这个变量改为该函数的静态局部变量，以降低模块间的耦合度；
-  C.设计和使用访问动态全局变量、静态全局变量、静态局部变量的函数时，需要考虑重入问题，因为他们都放在静态数据存储区，全局可见；
-  D.如果我们需要一个可重入的函数，那么，我们一定要避免函数中使用static变量(这样的函数被称为：带"内部存储器"功能的的函数)
-  E.函数中必须要使用static变量情况：比如**当某函数的返回值为指针类型时，则必须是 `static` 的局部变量的地址作为返回值，若为 `auto` 类型，则返回为错指针**。

```c
#include <stdio.h>
#include <time.h>

#define TIME 1000000000
int m, n = TIME; /* 全局变量 */

int main(void)
{   
    time_t start, stop;
    register int a, b = TIME; /* 寄存器变量 */
    int x, y = TIME;          /* 一般变量   */

    time(&start);
    for (a = 0; a < b; a++);
    time(&stop);
    printf("寄存器变量用时: %ld 秒\n", stop - start);
    
    time(&start);
    for (x = 0; x < y; x++);
    time(&stop);
    printf("一般变量用时: %ld 秒\n", stop - start);
    
    time(&start);
    for (m = 0; m < n; m++);
    time(&stop);
    printf("全局变量用时: %ld 秒\n", stop - start);

    return 0;
}

输出结果：

寄存器变量用时: 1 秒
一般变量用时: 8 秒
全局变量用时: 9 秒
```

---
# 6. 运算符








---

> 参考：
>
> 1. 翁凯 《C 语言程序设计》
> 2. [郝斌C语言自学教程（video）](https://www.bilibili.com/video/BV1os411h77o?p=12)
> 3. [C语言程序设计教程（video）](https://www.bilibili.com/video/BV1q54y1q79w?from=search&seid=9645914219204074845)
> 4. [C语言教程（page）](https://www.runoob.com/cprogramming/c-basic-syntax.html)
> 5. [C语言中文网（page）](http://c.biancheng.net/view/1760.html)
> 6. 《C Primer Plus》

